FROM docker.io/tomcat:9.0.68-jdk17

ARG WARFILE=target/*.war

RUN mv /usr/local/tomcat/webapps.dist/* /usr/local/tomcat/webapps

COPY /target/sb-war-docker-0.0.1-SNAPSHOT /usr/local/tomcat/webapps/samplewarapp

COPY ${WAR_FILE} /tmp/app.war

COPY tmp/tomcat-users.xml /usr/local/tomcat/conf/
COPY tmp/context.xml /usr/local/tomcat/webapps/manager/META-INF/context.xml



RUN chown -R tomcat /usr/local/tomcat

RUN addgroup  springboot && adduser tomcat
RUN usermod -G springboot tomcat
USER tomcat

EXPOSE 8080
ENTRYPOINT ["catalina.sh", "run"]